<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.LineChart?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.shape.Line?>
<?import javafx.scene.shape.Rectangle?>
<?import javafx.scene.shape.Circle?>
<?import javafx.scene.text.Font?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.image.ImageView?>

<StackPane maxHeight="-Infinity" maxWidth="-Infinity" minHeight="-Infinity" minWidth="-Infinity" 
           prefHeight="720.0" prefWidth="1200.0" xmlns="http://javafx.com/javafx/23.0.1" 
           xmlns:fx="http://javafx.com/fxml/1" fx:controller="controllers.AfficherContrats">
   <children>
      <AnchorPane prefHeight="720.0" prefWidth="1200.0" styleClass="main-container">
         <children>
            <BorderPane prefHeight="720.0" prefWidth="1200.0" AnchorPane.bottomAnchor="0.0" 
                       AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0" AnchorPane.topAnchor="0.0">
               
               <!-- HEADER MODERNISÉ -->
               <top>
                  <AnchorPane prefHeight="80.0" prefWidth="1200.0" styleClass="modern-header" 
                             stylesheets="@ModernStyle.css" BorderPane.alignment="CENTER">
                     <children>
                        <HBox alignment="CENTER_LEFT" prefHeight="80.0" prefWidth="1200.0" spacing="20.0">
                           <padding>
                              <Insets left="30.0" right="30.0" />
                           </padding>
                           <children>
                              <!-- Logo/Icon placeholder -->
                              <Circle fill="#6366f1" radius="20.0" styleClass="logo-circle" />
                              
                              <VBox alignment="CENTER_LEFT" spacing="2.0">
                                 <children>
                                    <Label text="HRManager Pro" styleClass="brand-title">
                                       <font>
                                          <Font name="System Bold" size="24.0" />
                                       </font>
                                    </Label>
                                    <Label text="Human Resources Management System" styleClass="brand-subtitle">
                                       <font>
                                          <Font size="12.0" />
                                       </font>
                                    </Label>
                                 </children>
                              </VBox>
                              
                              <!-- Spacer -->
                              <AnchorPane HBox.hgrow="ALWAYS" />
                              
                              <!-- User menu placeholder -->
                              <HBox alignment="CENTER" spacing="15.0">
                                 <children>
                                    <Button text="🔔" styleClass="icon-btn" />
                                    <ImageView fx:id="avatarImage" fitHeight="18.0" fitWidth="18.0" pickOnBounds="true" preserveRatio="true" styleClass="avatar-image">
   <clip>
      <Circle radius="18.0" />
   </clip>
</ImageView>
                                 </children>
                              </HBox>
                           </children>
                        </HBox>
                     </children>
                  </AnchorPane>
               </top>
               
               <!-- SIDEBAR MODERNISÉE -->
               <left>
                  <AnchorPane prefHeight="640.0" prefWidth="260.0" BorderPane.alignment="CENTER">
                     <children>
                        <VBox prefHeight="640.0" prefWidth="260.0" styleClass="modern-sidebar" 
                             stylesheets="@ModernStyle.css" spacing="10.0">
                           <padding>
                              <Insets bottom="20.0" left="20.0" right="20.0" top="30.0" />
                           </padding>
                           <children>
                              <Label text="NAVIGATION" styleClass="sidebar-section-title">
                                 <font>
                                    <Font name="System Bold" size="11.0" />
                                 </font>
                              </Label>
                              
                              <!-- Navigation buttons avec icônes -->
                              <Button onAction="#showHome" prefHeight="45.0" prefWidth="220.0" 
                                     styleClass="modern-nav-btn" text="📊  Dashboard" />
                              
                              <Button onAction="#showDepartments" prefHeight="45.0" prefWidth="220.0" 
                                     styleClass="modern-nav-btn-active" text="📋  Contrats" />
                              
                              <Button onAction="#showEmployees" prefHeight="45.0" prefWidth="220.0" 
                                     styleClass="modern-nav-btn" text="💰  Salaires" />
                              
                              <!-- Séparateur -->
                              <VBox prefHeight="20.0" />
                              
                              <Label text="OUTILS" styleClass="sidebar-section-title">
                                 <font>
                                    <Font name="System Bold" size="11.0" />
                                 </font>
                              </Label>
                              
                              <Button prefHeight="45.0" prefWidth="220.0" styleClass="modern-nav-btn" 
                                     text="📈  Rapports" />
                              
                              <Button prefHeight="45.0" prefWidth="220.0" styleClass="modern-nav-btn" 
                                     text="⚙️  Paramètres" />
                              
                              <!-- Spacer pour pousser logout vers le bas -->
                              <VBox VBox.vgrow="ALWAYS" />
                              
                              <Button prefHeight="45.0" prefWidth="220.0" styleClass="modern-logout-btn" 
                                     text="🚪  Déconnexion" />
                           </children>
                        </VBox>
                     </children>
                  </AnchorPane>
               </left>
               
               <!-- CONTENU PRINCIPAL -->
               <center>
                  <AnchorPane prefHeight="640.0" prefWidth="940.0" styleClass="main-content" BorderPane.alignment="CENTER">
                     <children>
                        <!-- HOME PANE MODERNISÉ -->
                        <AnchorPane fx:id="homePane" prefHeight="640.0" prefWidth="940.0" visible="false" 
                                   styleClass="content-pane">
                           <children>
                              <VBox prefHeight="640.0" prefWidth="940.0" spacing="25.0">
                                 <padding>
                                    <Insets bottom="30.0" left="30.0" right="30.0" top="30.0" />
                                 </padding>
                                 <children>
                                    <!-- Header de section -->
                                    <HBox alignment="CENTER_LEFT" spacing="15.0">
                                       <children>
                                          <Label text="Dashboard" styleClass="page-title">
                                             <font>
                                                <Font name="System Bold" size="32.0" />
                                             </font>
                                          </Label>
                                          <Label text="Vue d'ensemble de votre système RH" styleClass="page-subtitle">
                                             <font>
                                                <Font size="16.0" />
                                             </font>
                                          </Label>
                                       </children>
                                    </HBox>
                                    
                                    <!-- Cartes statistiques modernisées -->
                                    <HBox spacing="25.0" alignment="CENTER">
                                       <children>
                                          <!-- Carte Contrats -->
                                          <VBox styleClass="modern-stat-card" spacing="10.0" prefWidth="200.0">
                                             <children>
                                                <HBox alignment="CENTER_LEFT" spacing="10.0">
                                                   <children>
                                                      <Circle fill="#6366f1" radius="20.0" styleClass="stat-icon" />
                                                      <Label text="CONTRATS" styleClass="stat-label" />
                                                   </children>
                                                </HBox>
                                                <Label fx:id="contractCountLabel" text="0" styleClass="stat-number" />
                                                <Label text="+12% ce mois" styleClass="stat-trend-positive" />
                                             </children>
                                          </VBox>
                                          
                                          <!-- Carte Départements -->
                                          <VBox styleClass="modern-stat-card" spacing="10.0" prefWidth="200.0">
                                             <children>
                                                <HBox alignment="CENTER_LEFT" spacing="10.0">
                                                   <children>
                                                      <Circle fill="#10b981" radius="20.0" styleClass="stat-icon" />
                                                      <Label text="DÉPARTEMENTS" styleClass="stat-label" />
                                                   </children>
                                                </HBox>
                                                <Label fx:id="departmentCountLabel" text="0" styleClass="stat-number" />
                                                <Label text="+5% ce mois" styleClass="stat-trend-positive" />
                                             </children>
                                          </VBox>
                                          
                                          <!-- Carte Employés -->
                                          <VBox styleClass="modern-stat-card" spacing="10.0" prefWidth="200.0">
                                             <children>
                                                <HBox alignment="CENTER_LEFT" spacing="10.0">
                                                   <children>
                                                      <Circle fill="#f59e0b" radius="20.0" styleClass="stat-icon" />
                                                      <Label text="EMPLOYÉS" styleClass="stat-label" />
                                                   </children>
                                                </HBox>
                                                <Label text="142" styleClass="stat-number" />
                                                <Label text="+8% ce mois" styleClass="stat-trend-positive" />
                                             </children>
                                          </VBox>
                                          
                                          <!-- Carte Budget -->
                                          <VBox styleClass="modern-stat-card" spacing="10.0" prefWidth="200.0">
                                             <children>
                                                <HBox alignment="CENTER_LEFT" spacing="10.0">
                                                   <children>
                                                      <Circle fill="#ef4444" radius="20.0" styleClass="stat-icon" />
                                                      <Label text="BUDGET" styleClass="stat-label" />
                                                   </children>
                                                </HBox>
                                                <Label text="250K TND" styleClass="stat-number" />
                                                <Label text="-3% ce mois" styleClass="stat-trend-negative" />
                                             </children>
                                          </VBox>
                                       </children>
                                    </HBox>
                                    
                                    <!-- Tableau modernisé -->
                                    <VBox styleClass="modern-table-container" spacing="15.0">
                                       <children>
                                          <Label text="Seuils Salariaux par Département" styleClass="table-title" />
                                          <TableView fx:id="departmentThresholdTable" styleClass="modern-table" 
                                                    prefHeight="300.0">
                                             <columns>
                                                <TableColumn fx:id="departmentNameColumn" prefWidth="440.0" 
                                                           text="Nom du Département" />
                                                <TableColumn fx:id="salaryThresholdColumn" prefWidth="440.0" 
                                                           text="Seuil Salarial (TND)" />
                                             </columns>
                                          </TableView>
                                       </children>
                                    </VBox>
                                 </children>
                              </VBox>
                           </children>
                        </AnchorPane>

                        <!-- CONTRACTS PANE MODERNISÉ -->
                        <AnchorPane fx:id="employeesPane" prefHeight="640.0" prefWidth="940.0" styleClass="content-pane">
                           <children>
                              <VBox prefHeight="640.0" prefWidth="940.0" spacing="25.0">
                                 <padding>
                                    <Insets bottom="30.0" left="30.0" right="30.0" top="30.0" />
                                 </padding>
                                 <children>
                                    <!-- En-tête de page -->
                                    <HBox alignment="CENTER_LEFT" spacing="15.0">
                                       <children>
                                          <Label text="Gestion des Contrats" styleClass="page-title" >
                                          <font>
                                                <Font name="System Bold" size="32.0" />
                                             </font>
                                          </Label>
                                           <Label text="Informations du Contrat" styleClass="form-section-title" >
                                          <font>
                                                <Font size="16.0" />
                                             </font>
                                          </Label>
                                          <HBox alignment="CENTER_LEFT" spacing="10.0" HBox.hgrow="ALWAYS">
                                             <children>
                                                <AnchorPane HBox.hgrow="ALWAYS" />
                                                <Button onAction="#handleExportAll" styleClass="modern-export-btn" 
                                                       text="📤 Exporter Tout" />
                                             </children>
                                          </HBox>
                                       </children>
                                    </HBox>
                                    
                                    <!-- Formulaire modernisé -->
                                    <VBox styleClass="modern-form-container" spacing="20.0">
                                       <children>
                                         
                                          
                                          <!-- Première ligne -->
                                          <HBox spacing="20.0">
                                             <children>
                                                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                                   <children>
                                                      <Label text="Nom" styleClass="form-label" />
                                                      <TextField fx:id="name" styleClass="modern-input" />
                                                   </children>
                                                </VBox>
                                                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                                   <children>
                                                      <Label text="Email" styleClass="form-label" />
                                                      <TextField fx:id="email" styleClass="modern-input" />
                                                   </children>
                                                </VBox>
                                                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                                   <children>
                                                      <Label text="Rôle" styleClass="form-label" />
                                                      <TextField fx:id="role" styleClass="modern-input" />
                                                   </children>
                                                </VBox>
                                             </children>
                                          </HBox>
                                          
                                          <!-- Deuxième ligne -->
                                          <HBox spacing="20.0">
                                             <children>
                                                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                                   <children>
                                                      <Label text="Téléphone" styleClass="form-label" />
                                                      <TextField fx:id="phone" styleClass="modern-input" />
                                                   </children>
                                                </VBox>
                                                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                                   <children>
                                                      <Label text="Matricule" styleClass="form-label" />
                                                      <TextField fx:id="matricule" styleClass="modern-input" />
                                                   </children>
                                                </VBox>
                                                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                                   <children>
                                                      <Label text="CIN" styleClass="form-label" />
                                                      <TextField fx:id="cin" styleClass="modern-input" />
                                                   </children>
                                                </VBox>
                                             </children>
                                          </HBox>
                                          
                                          <!-- Troisième ligne -->
                                          <HBox spacing="20.0">
                                             <children>
                                                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                                   <children>
                                                      <Label text="Date de Début" styleClass="form-label" />
                                                      <TextField fx:id="dated" styleClass="modern-input" />
                                                   </children>
                                                </VBox>
                                                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                                   <children>
                                                      <Label text="Date de Fin" styleClass="form-label" />
                                                      <TextField fx:id="datef" styleClass="modern-input" />
                                                   </children>
                                                </VBox>
                                                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                                   <!-- Espace vide pour l'alignement -->
                                                </VBox>
                                             </children>
                                          </HBox>
                                          
                                          <!-- Boutons d'action -->
                                          <HBox spacing="12.0">
                                             <children>
                                                <Button onAction="#handleAddEmployee" styleClass="modern-primary-btn" 
                                                       text="➕ Ajouter" />
                                                <Button onAction="#handleUpdateEmployee" styleClass="modern-secondary-btn" 
                                                       text="✏️ Modifier" />
                                                <Button onAction="#handleDeleteEmployee" styleClass="modern-danger-btn" 
                                                       text="🗑️ Supprimer" />
                                                <Button onAction="#resetSearch" styleClass="modern-neutral-btn" 
                                                       text="🔄 Reset" />
                                                <AnchorPane HBox.hgrow="ALWAYS" />
                                                <Button onAction="#handleExportContracts" styleClass="modern-export-btn" 
                                                       text="📊 Exporter CSV" />
                                             </children>
                                          </HBox>
                                       </children>
                                    </VBox>
                                    
                                    <!-- Section recherche modernisée -->
                                    <HBox styleClass="modern-search-container" spacing="15.0" alignment="CENTER_LEFT">
                                       <children>
                                          <Label text="🔍" styleClass="search-icon" />
                                          <TextField fx:id="search" promptText="Rechercher des contrats..." 
                                                    styleClass="modern-search-input" prefWidth="300.0" 
                                                    onKeyReleased="#handleSearch" />
                                          <Button onAction="#handleAdvancedSearch" styleClass="modern-secondary-btn" 
                                                 text="Recherche Avancée" />
                                          <AnchorPane HBox.hgrow="ALWAYS" />
                                          <Label text="Filtres actifs:" styleClass="filter-label" />
                                       </children>
                                    </HBox>
                                    
                                    <!-- Tableau modernisé -->
                                    <TableView fx:id="tablec" onMouseClicked="#handleEmployeeTableClick" 
                                              styleClass="modern-table" prefHeight="200.0">
                                       <columns>
                                          <TableColumn fx:id="matricule1" prefWidth="120.0" text="Matricule" />
                                          <TableColumn fx:id="name1" prefWidth="180.0" text="Nom" />
                                          <TableColumn fx:id="cin1" prefWidth="120.0" text="CIN" />
                                          <TableColumn fx:id="role1" prefWidth="150.0" text="Rôle" />
                                          <TableColumn fx:id="dated1" prefWidth="370.0" text="Date de Début" />
                                       </columns>
                                    </TableView>
                                 </children>
                              </VBox>
                           </children>
                        </AnchorPane>

                        <!-- DEPARTMENTS PANE MODERNISÉ AVEC DOUBLE COURBE -->
                        <AnchorPane fx:id="departmentsPane" prefHeight="640.0" prefWidth="940.0" 
                                   styleClass="content-pane" visible="false">
                           <children>
                              <VBox prefHeight="640.0" prefWidth="940.0" spacing="25.0">
                                 <padding>
                                    <Insets bottom="30.0" left="30.0" right="30.0" top="30.0" />
                                 </padding>
                                 <children>
                                    <!-- En-tête -->
                                    <HBox alignment="CENTER_LEFT" spacing="15.0">
                                       <children>
                                          <Label text="Gestion des Départements" styleClass="page-title" >
                                          <font>
                                                <Font name="System Bold" size="32.0" />
                                             </font>
                                          </Label>
                                          <Label text="Informations du Département" styleClass="form-section-title" >
                                          <font>
                                                <Font size="16.0" />
                                             </font>
                                          </Label>
                                          <AnchorPane HBox.hgrow="ALWAYS" />
                                          <Button onAction="#handleExportDepartments" styleClass="modern-export-btn" 
                                                 text="📤 Exporter CSV" />
                                       </children>
                                    </HBox>
                                    
                                    <!-- Formulaire modernisé -->
                                    <VBox styleClass="modern-form-container" spacing="20.0">
                                       <children>
                                          
                                          
                                          <HBox spacing="20.0">
                                             <children>
                                                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                                   <children>
                                                      <Label text="Département" styleClass="form-label" />
                                                      <TextField fx:id="depart" styleClass="modern-input" />
                                                   </children>
                                                </VBox>
                                                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                                   <children>
                                                      <Label text="Rôle du Département" styleClass="form-label" />
                                                      <TextField fx:id="roledepart" styleClass="modern-input" />
                                                   </children>
                                                </VBox>
                                             </children>
                                          </HBox>
                                          
                                          <HBox spacing="20.0">
                                             <children>
                                                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                                   <children>
                                                      <Label text="Somme des Salaires" styleClass="form-label" />
                                                      <TextField fx:id="somme" styleClass="modern-input" />
                                                   </children>
                                                </VBox>
                                                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                                   <children>
                                                      <Label text="Nombre de Salaires" styleClass="form-label" />
                                                      <TextField fx:id="nombre" styleClass="modern-input" />
                                                   </children>
                                                </VBox>
                                             </children>
                                          </HBox>
                                          
                                          <HBox spacing="12.0">
                                             <children>
                                                <Button fx:id="department_add_btn" onAction="#handleAddDepartment" 
                                                       styleClass="modern-primary-btn" text="➕ Ajouter" />
                                                <Button fx:id="department_add_btn1" onAction="#handleUpdateDepartment" 
                                                       styleClass="modern-secondary-btn" text="✏️ Modifier" />
                                                <Button fx:id="department_delete_btn" onAction="#handleDeleteDepartment" 
                                                       styleClass="modern-danger-btn" text="🗑️ Supprimer" />
                                                <AnchorPane HBox.hgrow="ALWAYS" />
                                                <!-- Nouveau bouton pour synchroniser les données -->
                                                <Button fx:id="syncChartBtn" onAction="#handleSyncChart" 
                                                       styleClass="modern-accent-btn" text="🔄 Synchroniser Graphique" />
                                             </children>
                                          </HBox>
                                       </children>
                                    </VBox>
                                    
                                    <!-- Graphique modernisé avec double courbe -->
                                    <VBox styleClass="modern-chart-container" spacing="15.0">
                                       <children>
                                          <HBox alignment="CENTER_LEFT" spacing="20.0">
                                             <children>
                                                <Label text="Comparaison Salaires par Département" styleClass="chart-title" />
                                                <AnchorPane HBox.hgrow="ALWAYS" />
                                                <!-- Légende des courbes -->
                                                <HBox spacing="20.0" alignment="CENTER">
                                                   <children>
                                                      <HBox spacing="8.0" alignment="CENTER">
                                                         <children>
                                                            <Circle fill="#6366f1" radius="6.0" />
                                                            <Label text="Somme des Salaires" styleClass="legend-label" />
                                                         </children>
                                                      </HBox>
                                                      <HBox spacing="8.0" alignment="CENTER">
                                                         <children>
                                                            <Circle fill="#10b981" radius="6.0" />
                                                            <Label text="Seuils Salariaux" styleClass="legend-label" />
                                                         </children>
                                                      </HBox>
                                                   </children>
                                                </HBox>
                                             </children>
                                          </HBox>
                                          
                                          <LineChart fx:id="departmentChart" styleClass="modern-chart" 
                                                    prefHeight="300.0" animated="true" createSymbols="true">
                                             <xAxis>
                                                <CategoryAxis side="BOTTOM" label="Départements" />
                                             </xAxis>
                                             <yAxis>
                                                <NumberAxis side="LEFT" label="Montant (TND)" />
                                             </yAxis>
                                          </LineChart>
                                       </children>
                                    </VBox>
                                 </children>
                              </VBox>
                           </children>
                        </AnchorPane>
                     </children>
                  </AnchorPane>
               </center>
            </BorderPane>
         </children>
      </AnchorPane>
   </children>
</StackPane>